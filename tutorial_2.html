

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Tutorial Part 2: Creating a Distribution-Ready Pinboard Workflow &#8212; Alfred-Workflow 1.38.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="User Guide" href="guide/index.html" />
    <link rel="prev" title="Tutorial Part 1: Creating a Basic Pinboard Workflow" href="tutorial_1.html" />

   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />


<!--[if lt IE 9]>
  <link rel="stylesheet" href="_static/gh-fork-ribbon.ie.css">
<![endif]-->
<link rel="stylesheet" href="_static/custom.css">

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tutorial-part-2-creating-a-distribution-ready-pinboard-workflow">
<span id="tutorial-2"></span><h1>Tutorial Part 2: Creating a Distribution-Ready Pinboard Workflow<a class="headerlink" href="#tutorial-part-2-creating-a-distribution-ready-pinboard-workflow" title="Permalink to this headline">¶</a></h1>
<p>In which we create a <a class="reference external" href="https://pinboard.in/">Pinboard.in</a> workflow ready for mass consumption.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#performing-multiple-actions-from-one-script" id="id4">Performing multiple actions from one script</a></li>
<li><a class="reference internal" href="#multi-step-actions" id="id5">Multi-step actions</a></li>
<li><a class="reference internal" href="#saving-settings" id="id6">Saving settings</a><ul>
<li><a class="reference internal" href="#saving-settings-securely" id="id7">Saving settings securely</a></li>
</ul>
</li>
<li><a class="reference internal" href="#magic-arguments" id="id8">“Magic” arguments</a></li>
<li><a class="reference internal" href="#logging" id="id9">Logging</a></li>
<li><a class="reference internal" href="#spit-and-polish" id="id10">Spit and polish</a><ul>
<li><a class="reference internal" href="#two-actions-one-keyword" id="id11">Two actions, one keyword</a></li>
<li><a class="reference internal" href="#notifying-the-user-if-there-are-no-results" id="id12">Notifying the user if there are no results</a></li>
<li><a class="reference internal" href="#greased-lightning-background-updates" id="id13">Greased lightning: background updates</a><ul>
<li><a class="reference internal" href="#background-updater-script" id="id14">Background updater script</a></li>
<li><a class="reference internal" href="#running-update-py-from-pinboard-py" id="id15">Running <code class="docutils literal notranslate"><span class="pre">update.py</span></code> from <code class="docutils literal notranslate"><span class="pre">pinboard.py</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#the-fruits-of-your-labour" id="id16">The fruits of your labour</a><ul>
<li><a class="reference internal" href="#sharing-your-workflow" id="id17">Sharing your workflow</a></li>
<li><a class="reference internal" href="#updating-your-workflow" id="id18">Updating your workflow</a><ul>
<li><a class="reference internal" href="#the-packal-updater" id="id19">The Packal Updater</a></li>
<li><a class="reference internal" href="#github-releases" id="id20">GitHub releases</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<p>In the <a class="reference internal" href="tutorial.html#tutorial"><span class="std std-ref">first part</span></a> of the tutorial, we built a useable
workflow to view, search and open your recent Pinboard posts. The workflow
isn’t quite ready to be distributed to other users, however: we can’t expect
them to go grubbing around in the source code like an animal to set their own
API keys.</p>
<p>What’s more, an update to the workflow would overwrite their changes.</p>
<p>So now we’re going to edit the workflow so users can add their API key from the
comfort of Alfred’s friendly query box and use
<code class="xref py py-attr docutils literal notranslate"><span class="pre">Workflow.settings</span></code>
to save it in the workflow’s data directory where it won’t get overwritten.</p>
<div class="section" id="performing-multiple-actions-from-one-script">
<h2><a class="toc-backref" href="#id4">Performing multiple actions from one script</a><a class="headerlink" href="#performing-multiple-actions-from-one-script" title="Permalink to this headline">¶</a></h2>
<p>To set the user’s API key, we’re going to need a new action. We could write a
second script to do this, but we’re going to stick with one script and make it
smart enough to do two things, instead. The advantage of using one script is
that if you build a workflow with lots of actions, you don’t have a dozen or
more scripts to manage.</p>
<p>We’ll start by adding an argument parser (using <a class="reference external" href="https://docs.python.org/2.7/library/argparse.html#module-argparse" title="(in Python v2.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a> <a class="footnote-reference" href="#id3" id="id1">[1]</a>) to
<code class="docutils literal notranslate"><span class="pre">main()</span></code> and some if-clauses to alter the script’s behaviour depending on the
arguments passed to it by Alfred.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="c1"># encoding: utf-8</span>

 <span class="kn">import</span> <span class="nn">sys</span>
<span class="hll"> <span class="kn">import</span> <span class="nn">argparse</span>
</span><span class="hll"> <span class="kn">from</span> <span class="nn">workflow</span> <span class="kn">import</span> <span class="n">Workflow</span><span class="p">,</span> <span class="n">ICON_WEB</span><span class="p">,</span> <span class="n">ICON_WARNING</span><span class="p">,</span> <span class="n">web</span>
</span>

<span class="hll"> <span class="k">def</span> <span class="nf">get_recent_posts</span><span class="p">(</span><span class="n">api_key</span><span class="p">):</span>
</span><span class="hll">     <span class="sd">&quot;&quot;&quot;Retrieve recent posts from Pinboard.in</span>
</span><span class="hll">
</span><span class="hll"><span class="sd">     Returns a list of post dictionaries.</span>
</span><span class="hll">
</span><span class="hll"><span class="sd">     &quot;&quot;&quot;</span>
</span><span class="hll">     <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://api.pinboard.in/v1/posts/recent&#39;</span>
</span><span class="hll">     <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">auth_token</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>
</span>     <span class="n">r</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

     <span class="c1"># throw an error if request failed</span>
     <span class="c1"># Workflow will catch this and show it to the user</span>
     <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

     <span class="c1"># Parse the JSON returned by pinboard and extract the posts</span>
     <span class="n">result</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
     <span class="n">posts</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;posts&#39;</span><span class="p">]</span>
     <span class="k">return</span> <span class="n">posts</span>


 <span class="k">def</span> <span class="nf">search_key_for_post</span><span class="p">(</span><span class="n">post</span><span class="p">):</span>
     <span class="sd">&quot;&quot;&quot;Generate a string search key for a post&quot;&quot;&quot;</span>
     <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
     <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">])</span>  <span class="c1"># title of post</span>
     <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;tags&#39;</span><span class="p">])</span>  <span class="c1"># post tags</span>
     <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;extended&#39;</span><span class="p">])</span>  <span class="c1"># description</span>
     <span class="k">return</span> <span class="sa">u</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>


 <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">wf</span><span class="p">):</span>

<span class="hll">     <span class="c1"># build argument parser to parse script args and collect their</span>
</span><span class="hll">     <span class="c1"># values</span>
</span><span class="hll">     <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
</span><span class="hll">     <span class="c1"># add an optional (nargs=&#39;?&#39;) --setkey argument and save its</span>
</span><span class="hll">     <span class="c1"># value to &#39;apikey&#39; (dest). This will be called from a separate &quot;Run Script&quot;</span>
</span><span class="hll">     <span class="c1"># action with the API key</span>
</span><span class="hll">     <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--setkey&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;apikey&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</span><span class="hll">     <span class="c1"># add an optional query and save it to &#39;query&#39;</span>
</span><span class="hll">     <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;query&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</span><span class="hll">     <span class="c1"># parse the script&#39;s arguments</span>
</span><span class="hll">     <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">wf</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">     <span class="c1">####################################################################</span>
</span><span class="hll">     <span class="c1"># Save the provided API key</span>
</span><span class="hll">     <span class="c1">####################################################################</span>
</span><span class="hll">
</span><span class="hll">     <span class="c1"># decide what to do based on arguments</span>
</span><span class="hll">     <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">apikey</span><span class="p">:</span>  <span class="c1"># Script was passed an API key</span>
</span><span class="hll">         <span class="c1"># save the key</span>
</span><span class="hll">         <span class="n">wf</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;api_key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">apikey</span>
</span><span class="hll">         <span class="k">return</span> <span class="mi">0</span>  <span class="c1"># 0 means script exited cleanly</span>
</span><span class="hll">
</span><span class="hll">     <span class="c1">####################################################################</span>
</span><span class="hll">     <span class="c1"># Check that we have an API key saved</span>
</span><span class="hll">     <span class="c1">####################################################################</span>
</span><span class="hll">
</span><span class="hll">     <span class="n">api_key</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;api_key&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</span><span class="hll">     <span class="k">if</span> <span class="ow">not</span> <span class="n">api_key</span><span class="p">:</span>  <span class="c1"># API key has not yet been set</span>
</span><span class="hll">         <span class="n">wf</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s1">&#39;No API key set.&#39;</span><span class="p">,</span>
</span><span class="hll">                     <span class="s1">&#39;Please use pbsetkey to set your Pinboard API key.&#39;</span><span class="p">,</span>
</span><span class="hll">                     <span class="n">valid</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
</span><span class="hll">                     <span class="n">icon</span><span class="o">=</span><span class="n">ICON_WARNING</span><span class="p">)</span>
</span><span class="hll">         <span class="n">wf</span><span class="o">.</span><span class="n">send_feedback</span><span class="p">()</span>
</span><span class="hll">         <span class="k">return</span> <span class="mi">0</span>
</span><span class="hll">
</span><span class="hll">     <span class="c1">####################################################################</span>
</span><span class="hll">     <span class="c1"># View/filter Pinboard posts</span>
</span><span class="hll">     <span class="c1">####################################################################</span>
</span><span class="hll">
</span><span class="hll">     <span class="n">query</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">query</span>
</span><span class="hll">     <span class="c1"># Retrieve posts from cache if available and no more than 600</span>
</span><span class="hll">     <span class="c1"># seconds old</span>
</span><span class="hll">
</span><span class="hll">     <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
</span><span class="hll">         <span class="sd">&quot;&quot;&quot;`cached_data` can only take a bare callable (no args),</span>
</span><span class="hll"><span class="sd">         so we need to wrap callables needing arguments in a function</span>
</span><span class="hll"><span class="sd">         that needs none.</span>
</span><span class="hll"><span class="sd">         &quot;&quot;&quot;</span>
</span><span class="hll">         <span class="k">return</span> <span class="n">get_recent_posts</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">     <span class="n">posts</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">cached_data</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="n">wrapper</span><span class="p">,</span> <span class="n">max_age</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</span>
     <span class="c1"># If script was passed a query, use it to filter posts</span>
     <span class="k">if</span> <span class="n">query</span><span class="p">:</span>
         <span class="n">posts</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">posts</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">search_key_for_post</span><span class="p">,</span> <span class="n">min_score</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

     <span class="c1"># Loop through the returned posts and add a item for each to</span>
     <span class="c1"># the list of results for Alfred</span>
     <span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">posts</span><span class="p">:</span>
         <span class="n">wf</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span>
                     <span class="n">subtitle</span><span class="o">=</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">],</span>
                     <span class="n">arg</span><span class="o">=</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">],</span>
                     <span class="n">valid</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                     <span class="n">icon</span><span class="o">=</span><span class="n">ICON_WEB</span><span class="p">)</span>

     <span class="c1"># Send the results to Alfred as XML</span>
     <span class="n">wf</span><span class="o">.</span><span class="n">send_feedback</span><span class="p">()</span>
     <span class="k">return</span> <span class="mi">0</span>


 <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="sa">u</span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
     <span class="n">wf</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">()</span>
     <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">wf</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<p>Quite a lot has happened here: at the top in line 5, we’re importing a couple
more icons that we use in <code class="docutils literal notranslate"><span class="pre">main()</span></code> to notify the user that their API key is
missing and that they should set it (lines 65–72).</p>
<p>(You can see a list of all supported icons <a class="reference internal" href="guide/icons.html#icon-list"><span class="std std-ref">here</span></a>.)</p>
<p>We’ve adapted <code class="docutils literal notranslate"><span class="pre">get_recent_posts()</span></code> to accept an <code class="docutils literal notranslate"><span class="pre">api_key</span></code> argument. We <em>could</em>
continue to use the <code class="docutils literal notranslate"><span class="pre">API_KEY</span></code> global variable, but that’d be bad form.</p>
<p>As a result of this, we’ve had to alter the way
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Workflow.cached_data()</span></code> is
called. It can’t call a function that requires any arguments, so we’ve added a
<code class="docutils literal notranslate"><span class="pre">wrapper()</span></code> function within <code class="docutils literal notranslate"><span class="pre">main()</span></code> (lines 82–87) that calls
<code class="docutils literal notranslate"><span class="pre">get_recent_posts()</span></code> with the necessary <code class="docutils literal notranslate"><span class="pre">api_key</span></code> arguments, and we pass
this <code class="docutils literal notranslate"><span class="pre">wrapper()</span></code> function (which needs no arguments) to
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Workflow.cached_data()</span></code> instead
(line 89).</p>
<p>At the top of <code class="docutils literal notranslate"><span class="pre">main()</span></code> (lines 39–49), we’ve added an argument parser using
<a class="reference external" href="https://docs.python.org/2.7/library/argparse.html#module-argparse" title="(in Python v2.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a> that can take an optional <code class="docutils literal notranslate"><span class="pre">--apikey</span> <span class="pre">APIKEY</span></code> argument
and an optional <code class="docutils literal notranslate"><span class="pre">query</span></code> argument (remember the script doesn’t require a query).</p>
<p>Then, in lines 55–59, we check if an API key was passed using <code class="docutils literal notranslate"><span class="pre">--apikey</span></code>.
If it was, we save it using <code class="xref py py-attr docutils literal notranslate"><span class="pre">settings</span></code>
(see <a class="reference internal" href="#settings"><span class="std std-ref">below</span></a>).</p>
<p>Once this is done, we exit the script.</p>
<p>If no API key was specified with <code class="docutils literal notranslate"><span class="pre">--apikey</span></code>, we try to show/filter Pinboard
posts as before. But first of all, we now have to check to see if we already
have an API key saved (lines 65–72). If not, we show the user a warning
(No API key set) and exit the script.</p>
<p>Finally, if we have an API key saved, we retrieve it and show/filter the Pinboard
posts just as before (lines 78–107).</p>
<p>Of course, we don’t have an API key saved, and we haven’t yet set up our
workflow in Alfred to save one, so the workflow currently won’t work. Try to
run it, and you’ll see the warning we just implemented:</p>
<img alt="_images/screen15_no_api_key.png" src="_images/screen15_no_api_key.png" />
<p>So let’s add that functionality now.</p>
</div>
<div class="section" id="multi-step-actions">
<h2><a class="toc-backref" href="#id5">Multi-step actions</a><a class="headerlink" href="#multi-step-actions" title="Permalink to this headline">¶</a></h2>
<p>Asking the user for input and saving it is best done in two steps:</p>
<ol class="arabic simple">
<li>Ask for the data.</li>
<li>Pass it to a second action to save it.</li>
</ol>
<p>A Script Filter is designed to be called constantly by Alfred and return results.
This time, we just want to get some data, so we’ll use a <strong>Keyword</strong> input instead.</p>
<p>Go back to your workflow in Alfred’s Preferences and add a <strong>Keyword</strong> input:</p>
<img alt="_images/screen16_keyword.png" src="_images/screen16_keyword.png" />
<p>And set it up as follows (we’ll use the keyword <code class="docutils literal notranslate"><span class="pre">pbsetkey</span></code> because that’s what we told the user to use
in the above warning message):</p>
<img alt="_images/screen17_set_apikey_keyword.png" src="_images/screen17_set_apikey_keyword.png" />
<p>You can now enter <code class="docutils literal notranslate"><span class="pre">pbsetkey</span></code> in Alfred and see the following:</p>
<img alt="_images/screen18_pbsetkey.png" src="_images/screen18_pbsetkey.png" />
<p>It won’t do anything yet, though, as we haven’t connected its output to anything.</p>
<p>Back in Alfred’s Preferences, add a <strong>Run Script</strong> action:</p>
<img alt="_images/screen19_runscript.png" src="_images/screen19_runscript.png" />
<p>and point it at our <code class="docutils literal notranslate"><span class="pre">pinboard.py</span></code> script with the <code class="docutils literal notranslate"><span class="pre">--setkey</span></code> argument:</p>
<img alt="_images/screen20_runscript_settings.png" src="_images/screen20_runscript_settings.png" />
<p>Finally, connect the <code class="docutils literal notranslate"><span class="pre">pbsetkey</span></code> <strong>Keyword</strong> to the new <strong>Run Script</strong> action:</p>
<img alt="_images/screen21_connection.png" src="_images/screen21_connection.png" />
<p>Now you can call <code class="docutils literal notranslate"><span class="pre">pbsetkey</span></code> in Alfred, paste in your Pinboard API key and hit
<strong>ENTER</strong>. It will be saved by the workflow and <code class="docutils literal notranslate"><span class="pre">pbrecent</span></code> will once again
work as expected. Try it.</p>
<p>It’s a little confusing receiving no feedback on whether the key was saved or not,
so go back into Alfred’s Preferences, and add an <strong>Output &gt; Post Notification</strong>
action to your workflow:</p>
<img alt="_images/screen22_add_notification.png" src="_images/screen22_add_notification.png" />
<p>In the resulting pop-up, enter a message to be shown in Notification Center:</p>
<img alt="_images/screen22_notification_settings.png" src="_images/screen22_notification_settings.png" />
<p>and connect the <strong>Run Script</strong> we just added to it:</p>
<img alt="_images/screen23_three_way.png" src="_images/screen23_three_way.png" />
<p>Try setting your API key again with <code class="docutils literal notranslate"><span class="pre">pbsetkey</span></code> and this time you’ll get a
notification that it was saved.</p>
</div>
<div class="section" id="saving-settings">
<span id="settings"></span><h2><a class="toc-backref" href="#id6">Saving settings</a><a class="headerlink" href="#saving-settings" title="Permalink to this headline">¶</a></h2>
<p>Saving the API key was pretty easy (1 line of code). <a class="reference internal" href="api/index.html#workflow.workflow.Settings" title="workflow.workflow.Settings"><code class="xref py py-class docutils literal notranslate"><span class="pre">Settings</span></code></a>
is a special dictionary that automatically saves itself when you change its
contents. It can be used much like a normal dictionary with the caveat that all
values must be serializable to JSON as the settings are saved as a JSON file in
the workflow’s data directory.</p>
<p>Very simple, yes, but secure? No. A better place to save the API key would be
in the user’s Keychain. Let’s do that.</p>
<div class="section" id="saving-settings-securely">
<span id="secure-settings"></span><h3><a class="toc-backref" href="#id7">Saving settings securely</a><a class="headerlink" href="#saving-settings-securely" title="Permalink to this headline">¶</a></h3>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">Workflow</span></code> provides three methods for managing data
saved in macOS’s Keychain: <code class="xref py py-meth docutils literal notranslate"><span class="pre">get_password()</span></code>,
<code class="xref py py-meth docutils literal notranslate"><span class="pre">save_password()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">delete_password()</span></code>.</p>
<p>They are all called with an <code class="docutils literal notranslate"><span class="pre">account</span></code> name and an optional <code class="docutils literal notranslate"><span class="pre">service</span></code> name
(by default, this is your workflow’s <code class="docutils literal notranslate"><span class="pre">bundle</span> <span class="pre">ID</span></code>).</p>
<p>Change your <code class="docutils literal notranslate"><span class="pre">pinboard.py</span></code> script as follows to use Keychain instead of a JSON
file to store your API key:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="c1"># encoding: utf-8</span>

 <span class="kn">import</span> <span class="nn">sys</span>
 <span class="kn">import</span> <span class="nn">argparse</span>
<span class="hll"> <span class="kn">from</span> <span class="nn">workflow</span> <span class="kn">import</span> <span class="n">Workflow</span><span class="p">,</span> <span class="n">ICON_WEB</span><span class="p">,</span> <span class="n">ICON_WARNING</span><span class="p">,</span> <span class="n">web</span><span class="p">,</span> <span class="n">PasswordNotFound</span>
</span>

 <span class="k">def</span> <span class="nf">get_recent_posts</span><span class="p">(</span><span class="n">api_key</span><span class="p">):</span>
     <span class="sd">&quot;&quot;&quot;Retrieve recent posts from Pinboard.in</span>

<span class="sd">     Returns a list of post dictionaries.</span>

<span class="sd">     &quot;&quot;&quot;</span>
     <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://api.pinboard.in/v1/posts/recent&#39;</span>
     <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">auth_token</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>
     <span class="n">r</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

     <span class="c1"># throw an error if request failed</span>
     <span class="c1"># Workflow will catch this and show it to the user</span>
     <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

     <span class="c1"># Parse the JSON returned by pinboard and extract the posts</span>
     <span class="n">result</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
     <span class="n">posts</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;posts&#39;</span><span class="p">]</span>
     <span class="k">return</span> <span class="n">posts</span>


 <span class="k">def</span> <span class="nf">search_key_for_post</span><span class="p">(</span><span class="n">post</span><span class="p">):</span>
     <span class="sd">&quot;&quot;&quot;Generate a string search key for a post&quot;&quot;&quot;</span>
     <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
     <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">])</span>  <span class="c1"># title of post</span>
     <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;tags&#39;</span><span class="p">])</span>  <span class="c1"># post tags</span>
     <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;extended&#39;</span><span class="p">])</span>  <span class="c1"># description</span>
     <span class="k">return</span> <span class="sa">u</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>


 <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">wf</span><span class="p">):</span>

     <span class="c1"># build argument parser to parse script args and collect their</span>
     <span class="c1"># values</span>
     <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
     <span class="c1"># add an optional (nargs=&#39;?&#39;) --apikey argument and save its</span>
     <span class="c1"># value to &#39;apikey&#39; (dest). This will be called from a separate &quot;Run Script&quot;</span>
     <span class="c1"># action with the API key</span>
     <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--setkey&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;apikey&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
     <span class="c1"># add an optional query and save it to &#39;query&#39;</span>
     <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;query&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
     <span class="c1"># parse the script&#39;s arguments</span>
     <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">wf</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>

     <span class="c1">####################################################################</span>
     <span class="c1"># Save the provided API key</span>
     <span class="c1">####################################################################</span>

     <span class="c1"># decide what to do based on arguments</span>
     <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">apikey</span><span class="p">:</span>  <span class="c1"># Script was passed an API key</span>
         <span class="c1"># save the key</span>
<span class="hll">         <span class="n">wf</span><span class="o">.</span><span class="n">save_password</span><span class="p">(</span><span class="s1">&#39;pinboard_api_key&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">apikey</span><span class="p">)</span>
</span>         <span class="k">return</span> <span class="mi">0</span>  <span class="c1"># 0 means script exited cleanly</span>

     <span class="c1">####################################################################</span>
     <span class="c1"># Check that we have an API key saved</span>
     <span class="c1">####################################################################</span>

<span class="hll">     <span class="k">try</span><span class="p">:</span>
</span><span class="hll">         <span class="n">api_key</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">get_password</span><span class="p">(</span><span class="s1">&#39;pinboard_api_key&#39;</span><span class="p">)</span>
</span><span class="hll">     <span class="k">except</span> <span class="n">PasswordNotFound</span><span class="p">:</span>  <span class="c1"># API key has not yet been set</span>
</span><span class="hll">         <span class="n">wf</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s1">&#39;No API key set.&#39;</span><span class="p">,</span>
</span><span class="hll">                     <span class="s1">&#39;Please use pbsetkey to set your Pinboard API key.&#39;</span><span class="p">,</span>
</span><span class="hll">                     <span class="n">valid</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
</span><span class="hll">                     <span class="n">icon</span><span class="o">=</span><span class="n">ICON_WARNING</span><span class="p">)</span>
</span><span class="hll">         <span class="n">wf</span><span class="o">.</span><span class="n">send_feedback</span><span class="p">()</span>
</span>         <span class="k">return</span> <span class="mi">0</span>

     <span class="c1">####################################################################</span>
     <span class="c1"># View/filter Pinboard posts</span>
     <span class="c1">####################################################################</span>

     <span class="n">query</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">query</span>
     <span class="c1"># Retrieve posts from cache if available and no more than 600</span>
     <span class="c1"># seconds old</span>

     <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
         <span class="sd">&quot;&quot;&quot;`cached_data` can only take a bare callable (no args),</span>
<span class="sd">         so we need to wrap callables needing arguments in a function</span>
<span class="sd">         that needs none.</span>
<span class="sd">         &quot;&quot;&quot;</span>
         <span class="k">return</span> <span class="n">get_recent_posts</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

     <span class="n">posts</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">cached_data</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="n">wrapper</span><span class="p">,</span> <span class="n">max_age</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>

     <span class="c1"># If script was passed a query, use it to filter posts</span>
     <span class="k">if</span> <span class="n">query</span><span class="p">:</span>
         <span class="n">posts</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">posts</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">search_key_for_post</span><span class="p">,</span> <span class="n">min_score</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

     <span class="c1"># Loop through the returned posts and add an item for each to</span>
     <span class="c1"># the list of results for Alfred</span>
     <span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">posts</span><span class="p">:</span>
         <span class="n">wf</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span>
                     <span class="n">subtitle</span><span class="o">=</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">],</span>
                     <span class="n">arg</span><span class="o">=</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">],</span>
                     <span class="n">valid</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                     <span class="n">icon</span><span class="o">=</span><span class="n">ICON_WEB</span><span class="p">)</span>

     <span class="c1"># Send the results to Alfred as XML</span>
     <span class="n">wf</span><span class="o">.</span><span class="n">send_feedback</span><span class="p">()</span>
     <span class="k">return</span> <span class="mi">0</span>


 <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="sa">u</span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
     <span class="n">wf</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">()</span>
     <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">wf</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_password()</span></code> raises a
<code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordNotFound</span></code> exception if the requested
password isn’t in your Keychain, so we import <code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordNotFound</span></code>
and change <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">not</span> <span class="pre">api_key:</span></code> to a <code class="docutils literal notranslate"><span class="pre">try</span> <span class="pre">...</span> <span class="pre">except</span></code> clause (lines 65–72).</p>
<p>Try running your workflow again. It will complain that you haven’t saved your
API key (it’s looking in Keychain now, not the settings), so set your API key
once again, and you should be able to browse your recent posts in Alfred once more.</p>
<p>And if you open <strong>Keychain Access</strong>, you’ll find the API key safely tucked away
in your Keychain:</p>
<img alt="_images/screen24_keychain.png" src="_images/screen24_keychain.png" />
<p>As a bonus, if you have multiple Macs and use iCloud Keychain, the API key will
be seamlessly synced across machines, saving you the trouble of setting up the
workflow multiple times.</p>
</div>
</div>
<div class="section" id="magic-arguments">
<h2><a class="toc-backref" href="#id8">“Magic” arguments</a><a class="headerlink" href="#magic-arguments" title="Permalink to this headline">¶</a></h2>
<p>Now that the API key is stored in Keychain, we don’t need it saved in the
workflow’s settings any more (and having it there that kind of defeats the
purpose of using Keychain). To get rid of it, we can use one of Alfred-Workflow’s
“magic” arguments: <code class="docutils literal notranslate"><span class="pre">workflow:delsettings</span></code>.</p>
<p>Open up Alfred, and enter <code class="docutils literal notranslate"><span class="pre">pbrecent</span> <span class="pre">workflow:delsettings</span></code>. You should see the
following message:</p>
<img alt="_images/screen25_magic.png" src="_images/screen25_magic.png" />
<p>Alfred-Workflow has recognised one of its “magic” arguments, performed
the corresponding action, logged it to the log file, notified the user via
Alfred and exited the workflow.</p>
<p>Magic arguments are designed to help coders develop and debug workflows. See
<a class="reference internal" href="guide/magic-arguments.html#magic-arguments"><span class="std std-ref">“Magic” arguments</span></a> for more details.</p>
</div>
<div class="section" id="logging">
<h2><a class="toc-backref" href="#id9">Logging</a><a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h2>
<p>There’s a log, you say? Yup. There’s a <a class="reference external" href="https://docs.python.org/2.7/library/logging.html#logging.Logger" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">logging.Logger</span></code></a>
instance at <code class="xref py py-attr docutils literal notranslate"><span class="pre">Workflow.logger</span></code>
configured to output to both the Terminal (in case you’re running your workflow
script in Terminal) and your workflow’s log file. Normally, I use it like this:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="kn">from</span> <span class="nn">workflow</span> <span class="kn">import</span> <span class="n">Workflow</span>

 <span class="n">log</span> <span class="o">=</span> <span class="bp">None</span>


 <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">wf</span><span class="p">):</span>
     <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Started&#39;</span><span class="p">)</span>

 <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
     <span class="n">wf</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">()</span>
     <span class="n">log</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">logger</span>
     <span class="n">wf</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Assigning <code class="xref py py-attr docutils literal notranslate"><span class="pre">Workflow.logger</span></code> to the
module global <code class="docutils literal notranslate"><span class="pre">log</span></code> is just a convenience. You could use <code class="docutils literal notranslate"><span class="pre">wf.logger</span></code> in
its place.</p>
</div>
<div class="section" id="spit-and-polish">
<h2><a class="toc-backref" href="#id10">Spit and polish</a><a class="headerlink" href="#spit-and-polish" title="Permalink to this headline">¶</a></h2>
<p>So far, the workflow’s looking pretty good. But there are still a few of things
that could be better. For one, it’s not necessarily obvious to a user where to
find their Pinboard API key (it took me a good, hard Googling to find it while
writing these tutorials). For another, it can be confusing if there are no results
from a workflow and Alfred shows its fallback Google/Amazon searches instead.
Finally, the workflow is unresponsive while updating
the list of recent posts from Pinboard. That can’t be helped if we don’t have any
posts cached, but apart from the very first run, we always will, so why don’t
we show what we have and update in the background?</p>
<p>Let’s fix those issues. The easy ones first.</p>
<div class="section" id="two-actions-one-keyword">
<h3><a class="toc-backref" href="#id11">Two actions, one keyword</a><a class="headerlink" href="#two-actions-one-keyword" title="Permalink to this headline">¶</a></h3>
<p>To solve the first issue (Pinboard API keys being hard to find), we’ll add a
second <strong>Keyword</strong> input that responds to the same <code class="docutils literal notranslate"><span class="pre">pbsetkey</span></code> keyword as our
other action, but this one will just send the user to the Pinboard
<a class="reference external" href="https://pinboard.in/settings/password">password settings page</a> where the API keys are kept.</p>
<p>Go back to your workflow in Alfred’s Preferences and add a new <strong>Keyword</strong> with
the following settings:</p>
<img alt="_images/screen26_keyword2.png" src="_images/screen26_keyword2.png" />
<p>Now when you type <code class="docutils literal notranslate"><span class="pre">pbsetkey</span></code> into Alfred, you should see two options:</p>
<img alt="_images/screen27_1_keyword_2_actions.png" src="_images/screen27_1_keyword_2_actions.png" />
<p>The second action doesn’t do anything yet, of course, because we haven’t
connected it to anything. So add an <strong>Open URL</strong> action in Alfred, enter this
URL:</p>
<p><a class="reference external" href="https://pinboard.in/settings/password">https://pinboard.in/settings/password</a></p>
<p>and leave all the settings at their defaults.</p>
<img alt="_images/screen28_open_url.png" src="_images/screen28_open_url.png" />
<p>Finally, connect your new <strong>Keyword</strong> to the new <strong>Open URL</strong> action:</p>
<img alt="_images/screen29_link.png" src="_images/screen29_link.png" />
<p>Enter <code class="docutils literal notranslate"><span class="pre">pbsetkey</span></code> into Alfred once more and try out the new action. Pinboard
should open in your default browser.</p>
<p>Easy peasy.</p>
</div>
<div class="section" id="notifying-the-user-if-there-are-no-results">
<span id="no-results-warning"></span><h3><a class="toc-backref" href="#id12">Notifying the user if there are no results</a><a class="headerlink" href="#notifying-the-user-if-there-are-no-results" title="Permalink to this headline">¶</a></h3>
<p>Alfred’s default behaviour when a Script Filter returns no results is to show
its fallback searches. This is also what it does if a workflow crashes. So,
the best thing to do when a user is explicitly using your workflow is to
show a message indicating that no results were found.</p>
<p>Change <code class="docutils literal notranslate"><span class="pre">pinboard.py</span></code> to the following:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="c1"># encoding: utf-8</span>

 <span class="kn">import</span> <span class="nn">sys</span>
 <span class="kn">import</span> <span class="nn">argparse</span>
 <span class="kn">from</span> <span class="nn">workflow</span> <span class="kn">import</span> <span class="n">Workflow</span><span class="p">,</span> <span class="n">ICON_WEB</span><span class="p">,</span> <span class="n">ICON_WARNING</span><span class="p">,</span> <span class="n">web</span><span class="p">,</span> <span class="n">PasswordNotFound</span>


 <span class="k">def</span> <span class="nf">get_recent_posts</span><span class="p">(</span><span class="n">api_key</span><span class="p">):</span>
     <span class="sd">&quot;&quot;&quot;Retrieve recent posts from Pinboard.in</span>

<span class="sd">     Returns a list of post dictionaries.</span>

<span class="sd">     &quot;&quot;&quot;</span>
     <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://api.pinboard.in/v1/posts/recent&#39;</span>
     <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">auth_token</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>
     <span class="n">r</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

     <span class="c1"># throw an error if request failed</span>
     <span class="c1"># Workflow will catch this and show it to the user</span>
     <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

     <span class="c1"># Parse the JSON returned by pinboard and extract the posts</span>
     <span class="n">result</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
     <span class="n">posts</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;posts&#39;</span><span class="p">]</span>
     <span class="k">return</span> <span class="n">posts</span>


 <span class="k">def</span> <span class="nf">search_key_for_post</span><span class="p">(</span><span class="n">post</span><span class="p">):</span>
     <span class="sd">&quot;&quot;&quot;Generate a string search key for a post&quot;&quot;&quot;</span>
     <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
     <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">])</span>  <span class="c1"># title of post</span>
     <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;tags&#39;</span><span class="p">])</span>  <span class="c1"># post tags</span>
     <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;extended&#39;</span><span class="p">])</span>  <span class="c1"># description</span>
     <span class="k">return</span> <span class="sa">u</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>


 <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">wf</span><span class="p">):</span>

     <span class="c1"># build argument parser to parse script args and collect their</span>
     <span class="c1"># values</span>
     <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
     <span class="c1"># add an optional (nargs=&#39;?&#39;) --apikey argument and save its</span>
     <span class="c1"># value to &#39;apikey&#39; (dest). This will be called from a separate &quot;Run Script&quot;</span>
     <span class="c1"># action with the API key</span>
     <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--setkey&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;apikey&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
     <span class="c1"># add an optional query and save it to &#39;query&#39;</span>
     <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;query&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
     <span class="c1"># parse the script&#39;s arguments</span>
     <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">wf</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>

     <span class="c1">####################################################################</span>
     <span class="c1"># Save the provided API key</span>
     <span class="c1">####################################################################</span>

     <span class="c1"># decide what to do based on arguments</span>
     <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">apikey</span><span class="p">:</span>  <span class="c1"># Script was passed an API key</span>
         <span class="c1"># save the key</span>
         <span class="n">wf</span><span class="o">.</span><span class="n">save_password</span><span class="p">(</span><span class="s1">&#39;pinboard_api_key&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">apikey</span><span class="p">)</span>
         <span class="k">return</span> <span class="mi">0</span>  <span class="c1"># 0 means script exited cleanly</span>

     <span class="c1">####################################################################</span>
     <span class="c1"># Check that we have an API key saved</span>
     <span class="c1">####################################################################</span>

     <span class="k">try</span><span class="p">:</span>
         <span class="n">api_key</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">get_password</span><span class="p">(</span><span class="s1">&#39;pinboard_api_key&#39;</span><span class="p">)</span>
     <span class="k">except</span> <span class="n">PasswordNotFound</span><span class="p">:</span>  <span class="c1"># API key has not yet been set</span>
         <span class="n">wf</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s1">&#39;No API key set.&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Please use pbsetkey to set your Pinboard API key.&#39;</span><span class="p">,</span>
                     <span class="n">valid</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                     <span class="n">icon</span><span class="o">=</span><span class="n">ICON_WARNING</span><span class="p">)</span>
         <span class="n">wf</span><span class="o">.</span><span class="n">send_feedback</span><span class="p">()</span>
         <span class="k">return</span> <span class="mi">0</span>

     <span class="c1">####################################################################</span>
     <span class="c1"># View/filter Pinboard posts</span>
     <span class="c1">####################################################################</span>

     <span class="n">query</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">query</span>
     <span class="c1"># Retrieve posts from cache if available and no more than 600</span>
     <span class="c1"># seconds old</span>

     <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
         <span class="sd">&quot;&quot;&quot;`cached_data` can only take a bare callable (no args),</span>
<span class="sd">         so we need to wrap callables needing arguments in a function</span>
<span class="sd">         that needs none.</span>
<span class="sd">         &quot;&quot;&quot;</span>
         <span class="k">return</span> <span class="n">get_recent_posts</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

     <span class="n">posts</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">cached_data</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="n">wrapper</span><span class="p">,</span> <span class="n">max_age</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>

     <span class="c1"># If script was passed a query, use it to filter posts</span>
     <span class="k">if</span> <span class="n">query</span><span class="p">:</span>
         <span class="n">posts</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">posts</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">search_key_for_post</span><span class="p">,</span> <span class="n">min_score</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="hll">     <span class="k">if</span> <span class="ow">not</span> <span class="n">posts</span><span class="p">:</span>  <span class="c1"># we have no data to show, so show a warning and stop</span>
</span><span class="hll">         <span class="n">wf</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s1">&#39;No posts found&#39;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="n">ICON_WARNING</span><span class="p">)</span>
</span><span class="hll">         <span class="n">wf</span><span class="o">.</span><span class="n">send_feedback</span><span class="p">()</span>
</span><span class="hll">         <span class="k">return</span> <span class="mi">0</span>
</span>
     <span class="c1"># Loop through the returned posts and add an item for each to</span>
     <span class="c1"># the list of results for Alfred</span>
     <span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">posts</span><span class="p">:</span>
         <span class="n">wf</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span>
                     <span class="n">subtitle</span><span class="o">=</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">],</span>
                     <span class="n">arg</span><span class="o">=</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">],</span>
                     <span class="n">valid</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                     <span class="n">icon</span><span class="o">=</span><span class="n">ICON_WEB</span><span class="p">)</span>

     <span class="c1"># Send the results to Alfred as XML</span>
     <span class="n">wf</span><span class="o">.</span><span class="n">send_feedback</span><span class="p">()</span>
     <span class="k">return</span> <span class="mi">0</span>


 <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="sa">u</span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
     <span class="n">wf</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">()</span>
     <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">wf</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<p>In lines 96-99, we check to see it there are any posts, and if not, we show
the user a warning, send the results to Alfred and exit. This does away with
Alfred’s distracting default searches and lets the user know exactly what’s
going on.</p>
</div>
<div class="section" id="greased-lightning-background-updates">
<span id="background-updates"></span><h3><a class="toc-backref" href="#id13">Greased lightning: background updates</a><a class="headerlink" href="#greased-lightning-background-updates" title="Permalink to this headline">¶</a></h3>
<p>All that remains is for our workflow to provide the blazing fast results Alfred
users have come to expect. No waiting around for glacial web services for the
likes of us. As long as we have some posts saved in the cache, we can show
those while grabbing an updated list in the background (and notifying the user
of the update, of course).</p>
<p>Now, there are a few different ways to start a background process. We could ask
the user to set up a <code class="docutils literal notranslate"><span class="pre">cron</span></code> job, but <code class="docutils literal notranslate"><span class="pre">cron</span></code> isn’t the easiest software to
use. We could add and load a <a class="reference external" href="http://robots.thoughtbot.com/example-writing-a-launch-agent-for-apples-launchd">Launch Agent</a>, but that’d run indefinitely,
whether or not the workflow is being used, and even if the workflow were
uninstalled. So we’d best start our background process from within the workflow
itself.</p>
<p>Normally, you’d use <a class="reference external" href="https://docs.python.org/2.7/library/subprocess.html#subprocess.Popen" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">subprocess.Popen</span></code></a> to start a background process,
but that doesn’t necessarily work quite as you might expect in Alfred: it
treats your workflow as still running till the subprocess has finished,
too, so it won’t call your workflow with a new query till the update is done.
Which is exactly what happens now and the behaviour we want to avoid.</p>
<p>Fortunately, Alfred-Workflow provides the <a class="reference internal" href="api/index.html#module-workflow.background" title="workflow.background"><code class="xref py py-mod docutils literal notranslate"><span class="pre">background</span></code></a> module
to solve this problem.</p>
<p>Using the <a class="reference internal" href="api/index.html#workflow.background.run_in_background" title="workflow.background.run_in_background"><code class="xref py py-func docutils literal notranslate"><span class="pre">background.run_in_background()</span></code></a>
and <a class="reference internal" href="api/index.html#workflow.background.is_running" title="workflow.background.is_running"><code class="xref py py-func docutils literal notranslate"><span class="pre">background.is_running()</span></code></a> functions,
we can easily run a script in the background while our workflow remains
responsive to Alfred’s queries.</p>
<p>Alfred-Workflow’s <a class="reference internal" href="api/index.html#module-workflow.background" title="workflow.background"><code class="xref py py-mod docutils literal notranslate"><span class="pre">background</span></code></a> module is based on, and uses the
same API as <a class="reference external" href="https://docs.python.org/2.7/library/subprocess.html#subprocess.call" title="(in Python v2.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">subprocess.call()</span></code></a>, but it runs the command as a background
daemon process (consequently, it won’t return anything). So, our updater script
will be called from our main workflow script, but <a class="reference internal" href="api/index.html#module-workflow.background" title="workflow.background"><code class="xref py py-mod docutils literal notranslate"><span class="pre">background</span></code></a>
will run it as a background process. This way, it will appear to exit
immediately, so Alfred will keep on calling our workflow every time the query
changes.</p>
<p>Meanwhile, our main workflow script will check if the background updater is
running and post a useful, friendly notification if it is.</p>
<p>Let’s have at it.</p>
<div class="section" id="background-updater-script">
<h4><a class="toc-backref" href="#id14">Background updater script</a><a class="headerlink" href="#background-updater-script" title="Permalink to this headline">¶</a></h4>
<p>Create a new file in the workflow root directory called <code class="docutils literal notranslate"><span class="pre">update.py</span></code> with these
contents:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="c1"># encoding: utf-8</span>


 <span class="kn">from</span> <span class="nn">workflow</span> <span class="kn">import</span> <span class="n">web</span><span class="p">,</span> <span class="n">Workflow</span><span class="p">,</span> <span class="n">PasswordNotFound</span>


 <span class="k">def</span> <span class="nf">get_recent_posts</span><span class="p">(</span><span class="n">api_key</span><span class="p">):</span>
     <span class="sd">&quot;&quot;&quot;Retrieve recent posts from Pinboard.in</span>

<span class="sd">     Returns a list of post dictionaries.</span>

<span class="sd">     &quot;&quot;&quot;</span>
     <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://api.pinboard.in/v1/posts/recent&#39;</span>
     <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">auth_token</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>
     <span class="n">r</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

     <span class="c1"># throw an error if request failed</span>
     <span class="c1"># Workflow will catch this and show it to the user</span>
     <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

     <span class="c1"># Parse the JSON returned by pinboard and extract the posts</span>
     <span class="n">result</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
     <span class="n">posts</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;posts&#39;</span><span class="p">]</span>
     <span class="k">return</span> <span class="n">posts</span>


 <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">wf</span><span class="p">):</span>
     <span class="k">try</span><span class="p">:</span>
         <span class="c1"># Get API key from Keychain</span>
         <span class="n">api_key</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">get_password</span><span class="p">(</span><span class="s1">&#39;pinboard_api_key&#39;</span><span class="p">)</span>

         <span class="c1"># Retrieve posts from cache if available and no more than 600</span>
         <span class="c1"># seconds old</span>

         <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
             <span class="sd">&quot;&quot;&quot;`cached_data` can only take a bare callable (no args),</span>
<span class="sd">             so we need to wrap callables needing arguments in a function</span>
<span class="sd">             that needs none.</span>
<span class="sd">             &quot;&quot;&quot;</span>
             <span class="k">return</span> <span class="n">get_recent_posts</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

         <span class="n">posts</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">cached_data</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="n">wrapper</span><span class="p">,</span> <span class="n">max_age</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
         <span class="c1"># Record our progress in the log file</span>
         <span class="n">wf</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;{} Pinboard posts cached&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">posts</span><span class="p">)))</span>

     <span class="k">except</span> <span class="n">PasswordNotFound</span><span class="p">:</span>  <span class="c1"># API key has not yet been set</span>
         <span class="c1"># Nothing we can do about this, so just log it</span>
         <span class="n">wf</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No API key saved&#39;</span><span class="p">)</span>

 <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
     <span class="n">wf</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">()</span>
     <span class="n">wf</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>At the top of the file (line 7), we’ve copied the <code class="docutils literal notranslate"><span class="pre">get_recent_posts()</span></code>
function from <code class="docutils literal notranslate"><span class="pre">pinboard.py</span></code> (we won’t need it there any more).</p>
<p>The contents of the <code class="docutils literal notranslate"><span class="pre">try</span></code> block in <code class="docutils literal notranslate"><span class="pre">main()</span></code> (lines 29–44) are once again
copied straight from <code class="docutils literal notranslate"><span class="pre">pinboard.py</span></code> (where we won’t be needing them any more).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">except</span></code> clause (lines 46–48) is to trap the
<code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordNotFound</span></code>
error that <code class="xref py py-meth docutils literal notranslate"><span class="pre">Workflow.get_password()</span></code>
will raise if the user hasn’t set their API key via Alfred yet. <code class="docutils literal notranslate"><span class="pre">update.py</span></code>
can quietly die if no API key has been set because <code class="docutils literal notranslate"><span class="pre">pinboard.py</span></code> takes care
of notifying the user to set their API key.</p>
<p>Let’s try out <code class="docutils literal notranslate"><span class="pre">update.py</span></code>. <a class="reference external" href="https://www.youtube.com/watch?v=xsCCgITrrWI">Open a Terminal window at the workflow root directory</a>
and run the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">update</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>If it works, you should see something like this:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="m">21</span>:59:59 workflow.py:855 DEBUG    get_password : net.deanishe.alfred-pinboard-recent:pinboard_api_key
 <span class="m">21</span>:59:59 workflow.py:544 DEBUG    Loading cached data from : /Users/dean/Library/Caches/com.runningwithcrayons.Alfred-2/Workflow Data/net.deanishe.alfred-pinboard-recent/posts.cache
<span class="hll"> <span class="m">21</span>:59:59 update.py:111 DEBUG    <span class="m">100</span> Pinboard posts cached
</span> <span class="m">22</span>:19:25 workflow.py:371 INFO     Opening workflow log file
</pre></div>
</td></tr></table></div>
<p>As you can see in the 3rd line, <code class="docutils literal notranslate"><span class="pre">update.py</span></code> did its job.</p>
</div>
<div class="section" id="running-update-py-from-pinboard-py">
<h4><a class="toc-backref" href="#id15">Running <code class="docutils literal notranslate"><span class="pre">update.py</span></code> from <code class="docutils literal notranslate"><span class="pre">pinboard.py</span></code></a><a class="headerlink" href="#running-update-py-from-pinboard-py" title="Permalink to this headline">¶</a></h4>
<p>So now let’s update <code class="docutils literal notranslate"><span class="pre">pinboard.py</span></code> to call <code class="docutils literal notranslate"><span class="pre">update.py</span></code> instead of doing the
update itself:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="c1"># encoding: utf-8</span>

 <span class="kn">import</span> <span class="nn">sys</span>
 <span class="kn">import</span> <span class="nn">argparse</span>
<span class="hll"> <span class="kn">from</span> <span class="nn">workflow</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Workflow</span><span class="p">,</span> <span class="n">ICON_WEB</span><span class="p">,</span> <span class="n">ICON_INFO</span><span class="p">,</span> <span class="n">ICON_WARNING</span><span class="p">,</span>
</span><span class="hll">                       <span class="n">PasswordNotFound</span><span class="p">)</span>
</span><span class="hll"> <span class="kn">from</span> <span class="nn">workflow.background</span> <span class="kn">import</span> <span class="n">run_in_background</span><span class="p">,</span> <span class="n">is_running</span>
</span>

 <span class="k">def</span> <span class="nf">search_key_for_post</span><span class="p">(</span><span class="n">post</span><span class="p">):</span>
     <span class="sd">&quot;&quot;&quot;Generate a string search key for a post&quot;&quot;&quot;</span>
     <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
     <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">])</span>  <span class="c1"># title of post</span>
     <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;tags&#39;</span><span class="p">])</span>  <span class="c1"># post tags</span>
     <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;extended&#39;</span><span class="p">])</span>  <span class="c1"># description</span>
     <span class="k">return</span> <span class="sa">u</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>


 <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">wf</span><span class="p">):</span>

     <span class="c1"># build argument parser to parse script args and collect their</span>
     <span class="c1"># values</span>
     <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
     <span class="c1"># add an optional (nargs=&#39;?&#39;) --apikey argument and save its</span>
     <span class="c1"># value to &#39;apikey&#39; (dest). This will be called from a separate &quot;Run Script&quot;</span>
     <span class="c1"># action with the API key</span>
     <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--setkey&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;apikey&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
     <span class="c1"># add an optional query and save it to &#39;query&#39;</span>
     <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;query&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
     <span class="c1"># parse the script&#39;s arguments</span>
     <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">wf</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>

     <span class="c1">####################################################################</span>
     <span class="c1"># Save the provided API key</span>
     <span class="c1">####################################################################</span>

     <span class="c1"># decide what to do based on arguments</span>
     <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">apikey</span><span class="p">:</span>  <span class="c1"># Script was passed an API key</span>
         <span class="c1"># save the key</span>
         <span class="n">wf</span><span class="o">.</span><span class="n">save_password</span><span class="p">(</span><span class="s1">&#39;pinboard_api_key&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">apikey</span><span class="p">)</span>
         <span class="k">return</span> <span class="mi">0</span>  <span class="c1"># 0 means script exited cleanly</span>

     <span class="c1">####################################################################</span>
     <span class="c1"># Check that we have an API key saved</span>
     <span class="c1">####################################################################</span>

     <span class="k">try</span><span class="p">:</span>
<span class="hll">         <span class="n">wf</span><span class="o">.</span><span class="n">get_password</span><span class="p">(</span><span class="s1">&#39;pinboard_api_key&#39;</span><span class="p">)</span>
</span>     <span class="k">except</span> <span class="n">PasswordNotFound</span><span class="p">:</span>  <span class="c1"># API key has not yet been set</span>
         <span class="n">wf</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s1">&#39;No API key set.&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Please use pbsetkey to set your Pinboard API key.&#39;</span><span class="p">,</span>
                     <span class="n">valid</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                     <span class="n">icon</span><span class="o">=</span><span class="n">ICON_WARNING</span><span class="p">)</span>
         <span class="n">wf</span><span class="o">.</span><span class="n">send_feedback</span><span class="p">()</span>
         <span class="k">return</span> <span class="mi">0</span>

     <span class="c1">####################################################################</span>
     <span class="c1"># View/filter Pinboard posts</span>
     <span class="c1">####################################################################</span>

     <span class="n">query</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">query</span>

     <span class="c1"># Get posts from cache. Set `data_func` to None, as we don&#39;t want to</span>
     <span class="c1"># update the cache in this script and `max_age` to 0 because we want</span>
     <span class="c1"># the cached data regardless of age</span>
<span class="hll">     <span class="n">posts</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">cached_data</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">max_age</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">     <span class="c1"># Start update script if cached data are too old (or doesn&#39;t exist)</span>
</span><span class="hll">     <span class="k">if</span> <span class="ow">not</span> <span class="n">wf</span><span class="o">.</span><span class="n">cached_data_fresh</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="n">max_age</span><span class="o">=</span><span class="mi">600</span><span class="p">):</span>
</span><span class="hll">         <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/usr/bin/python&#39;</span><span class="p">,</span> <span class="n">wf</span><span class="o">.</span><span class="n">workflowfile</span><span class="p">(</span><span class="s1">&#39;update.py&#39;</span><span class="p">)]</span>
</span><span class="hll">         <span class="n">run_in_background</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">     <span class="c1"># Notify the user if the cache is being updated</span>
</span><span class="hll">     <span class="k">if</span> <span class="n">is_running</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">):</span>
</span><span class="hll">         <span class="n">wf</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s1">&#39;Getting new posts from Pinboard&#39;</span><span class="p">,</span>
</span><span class="hll">                     <span class="n">valid</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
</span><span class="hll">                     <span class="n">icon</span><span class="o">=</span><span class="n">ICON_INFO</span><span class="p">)</span>
</span>
     <span class="c1"># If script was passed a query, use it to filter posts if we have some</span>
<span class="hll">     <span class="k">if</span> <span class="n">query</span> <span class="ow">and</span> <span class="n">posts</span><span class="p">:</span>
</span>         <span class="n">posts</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">posts</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">search_key_for_post</span><span class="p">,</span> <span class="n">min_score</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

     <span class="k">if</span> <span class="ow">not</span> <span class="n">posts</span><span class="p">:</span>  <span class="c1"># we have no data to show, so show a warning and stop</span>
         <span class="n">wf</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s1">&#39;No posts found&#39;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="n">ICON_WARNING</span><span class="p">)</span>
         <span class="n">wf</span><span class="o">.</span><span class="n">send_feedback</span><span class="p">()</span>
         <span class="k">return</span> <span class="mi">0</span>

     <span class="c1"># Loop through the returned posts and add a item for each to</span>
     <span class="c1"># the list of results for Alfred</span>
     <span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">posts</span><span class="p">:</span>
         <span class="n">wf</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span>
                     <span class="n">subtitle</span><span class="o">=</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">],</span>
                     <span class="n">arg</span><span class="o">=</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">],</span>
                     <span class="n">valid</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                     <span class="n">icon</span><span class="o">=</span><span class="n">ICON_WEB</span><span class="p">)</span>

     <span class="c1"># Send the results to Alfred as XML</span>
     <span class="n">wf</span><span class="o">.</span><span class="n">send_feedback</span><span class="p">()</span>
     <span class="k">return</span> <span class="mi">0</span>


 <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="sa">u</span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
     <span class="n">wf</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">()</span>
     <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">wf</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<p>First of all, we’ve changed the imports a bit. We no longer need
<a class="reference internal" href="api/index.html#module-workflow.web" title="workflow.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">workflow.web</span></code></a>, because we’ll use the functions
<a class="reference internal" href="api/index.html#workflow.background.run_in_background" title="workflow.background.run_in_background"><code class="xref py py-func docutils literal notranslate"><span class="pre">run_in_background()</span></code></a> from <a class="reference internal" href="api/index.html#module-workflow.background" title="workflow.background"><code class="xref py py-mod docutils literal notranslate"><span class="pre">workflow.background</span></code></a>
to call <code class="docutils literal notranslate"><span class="pre">update.py</span></code> instead, and we’ve also imported another icon
(<code class="docutils literal notranslate"><span class="pre">ICON_INFO</span></code>) to show our update message.</p>
<p>As noted before, <code class="docutils literal notranslate"><span class="pre">get_recent_posts()</span></code> has now moved to <code class="docutils literal notranslate"><span class="pre">update.py</span></code>, as has
the <code class="docutils literal notranslate"><span class="pre">wrapper()</span></code> function inside <code class="docutils literal notranslate"><span class="pre">main()</span></code>.</p>
<p>Also in <code class="docutils literal notranslate"><span class="pre">main()</span></code>, we no longer need <code class="docutils literal notranslate"><span class="pre">api_key</span></code>. However, we still want to
know if it has been saved, so we can show a warning if not, so we still call
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Workflow.get_password()</span></code>, but
without saving the result.</p>
<p>Most importantly, we’ve now expanded the update code to check if our cached
data are fresh with
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Workflow.cached_data_fresh()</span></code>
and to run the <code class="docutils literal notranslate"><span class="pre">update.py</span></code> script via
<a class="reference internal" href="api/index.html#workflow.background.run_in_background" title="workflow.background.run_in_background"><code class="xref py py-func docutils literal notranslate"><span class="pre">background.run_in_background()</span></code></a>
if not (<code class="xref py py-meth docutils literal notranslate"><span class="pre">Workflow.workflowfile()</span></code>
returns the full path to a file in the workflow’s root directory).</p>
<p>Then we check if the update process is running via
<a class="reference internal" href="api/index.html#workflow.background.is_running" title="workflow.background.is_running"><code class="xref py py-func docutils literal notranslate"><span class="pre">background.is_running()</span></code></a> using the
name we assigned to the process (<code class="docutils literal notranslate"><span class="pre">update</span></code>), and notify the user via Alfred’s
results if it is.</p>
<p>Finally, we call <code class="xref py py-meth docutils literal notranslate"><span class="pre">Workflow.cached_data()</span></code>
with <code class="docutils literal notranslate"><span class="pre">None</span></code> as the data-retrieval function (line 66) because we don’t want to
run an update from this script, blocking Alfred. As a consequence, it’s
possible that we’ll get back <code class="docutils literal notranslate"><span class="pre">None</span></code> instead of a list of posts if there are
no cached data, so we check for this before trying to filter <code class="docutils literal notranslate"><span class="pre">None</span></code> in line
80.</p>
</div>
</div>
</div>
<div class="section" id="the-fruits-of-your-labour">
<h2><a class="toc-backref" href="#id16">The fruits of your labour</a><a class="headerlink" href="#the-fruits-of-your-labour" title="Permalink to this headline">¶</a></h2>
<p>Now let’s give it a spin. Open up Alfred and enter <code class="docutils literal notranslate"><span class="pre">pbrecent</span>
<span class="pre">workflow:delcache</span></code> to clear the cached data. Then enter <code class="docutils literal notranslate"><span class="pre">pbrecent</span></code> and start
typing a query. You should see the “Getting new posts from Pinboard” message
appear. Unfortunately, we won’t see any results at the moment because we just
deleted the cached data.</p>
<p>To see our background updater weave its magic, we can change the <code class="docutils literal notranslate"><span class="pre">max_age</span></code> parameter
passed to <code class="xref py py-meth docutils literal notranslate"><span class="pre">Workflow.cached_data()</span></code>
in <code class="docutils literal notranslate"><span class="pre">update.py</span></code> on line 42 and to
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Workflow.cached_data_fresh()</span></code>
in <code class="docutils literal notranslate"><span class="pre">pinboard.py</span></code> on line 69 to <code class="docutils literal notranslate"><span class="pre">60</span></code>. Open up Alfred, enter <code class="docutils literal notranslate"><span class="pre">pbrecent</span></code> and
a couple of letters, then twiddle your thumbs for ~55 seconds. Type another letter
or two and you should see the “Getting new posts…” message <em>and</em> search
results. Cool, huh?</p>
<div class="section" id="sharing-your-workflow">
<h3><a class="toc-backref" href="#id17">Sharing your workflow</a><a class="headerlink" href="#sharing-your-workflow" title="Permalink to this headline">¶</a></h3>
<p>Now you’ve produced a technical marvel, it’s time to tell the world and enjoy
the well-earned plaudits. To build your workflow, open it up in Alfred’s
Preferences, right-click on the workflow’s name in the list on the left-hand
side, and choose <strong>Export…</strong>. This will save a <code class="docutils literal notranslate"><span class="pre">.alfredworkflow</span></code> file that
you can share with other people. <code class="docutils literal notranslate"><span class="pre">.alfredworkflow</span></code> files are just ZIP files
with a different extension. If you want to have a poke around inside one, just
change the extension to <code class="docutils literal notranslate"><span class="pre">.zip</span></code> and extract it in the normal way.</p>
<p>And how do you share your Workflow with the world?</p>
<p>There’s a <a class="reference external" href="http://www.alfredforum.com/forum/3-share-your-workflows/">Share your Workflows thread</a> on <a class="reference external" href="http://www.alfredforum.com/">the official Alfred forum</a>, but
being a forum, it’s less than ideal as a directory for workflows. Also, you’d
need to find your own place to host your workflow file (for which GitHub and
Dropbox are both good, free choices).</p>
<p>It’s a good idea to sign up for the Alfred forum and post a thread for your
workflow, so users can get in touch with you, but you might want to consider
uploading it to <a class="reference external" href="http://www.packal.org/">Packal.org</a>, a site specifically designed for hosting Alfred
workflows. Your workflow will be much easier to find on that site than in the
forum, and they’ll also host the workflow download for you.</p>
</div>
<div class="section" id="updating-your-workflow">
<h3><a class="toc-backref" href="#id18">Updating your workflow</a><a class="headerlink" href="#updating-your-workflow" title="Permalink to this headline">¶</a></h3>
<p>Software, like plans, never survives contact with the enemy, err, user.</p>
<p>It’s likely that a bug or two will be found and some sweet improvements will be
suggested, and so you’ll probably want to release a new and improved version of
your workflow somewhere down the line.</p>
<p>Instead of requiring your users to regularly visit a forum thread or a website
to check for an update, there are a couple of ways you can have your workflow
(semi-)automatically updated.</p>
<div class="section" id="the-packal-updater">
<h4><a class="toc-backref" href="#id19">The Packal Updater</a><a class="headerlink" href="#the-packal-updater" title="Permalink to this headline">¶</a></h4>
<p>The simplest way in terms of implementation is to upload your workflow to
<a class="reference external" href="http://www.packal.org/">Packal.org</a>. If you release a new version, any user who also uses the
<a class="reference external" href="http://www.packal.org/workflow/packal-updater">Packal Updater workflow</a> will then be notified of the updated version. The
disadvantage of this method is it only works if a user installs and uses the
<a class="reference external" href="http://www.packal.org/workflow/packal-updater">Packal Updater workflow</a>.</p>
</div>
<div class="section" id="github-releases">
<h4><a class="toc-backref" href="#id20">GitHub releases</a><a class="headerlink" href="#github-releases" title="Permalink to this headline">¶</a></h4>
<p>A <em>slightly</em> more complex to implement method is to use Alfred-Workflow’s
built-in support for updates via <a class="reference external" href="https://help.github.com/articles/about-releases">GitHub releases</a>. If you tell your
<code class="xref py py-class docutils literal notranslate"><span class="pre">Workflow</span></code> object the name of your GitHub repo and
the installed workflow’s version number, Alfred-Workflow will automatically
check for a new version every day.</p>
<p>By default, Alfred-Workflow won’t inform the user of the new version or
update the workflow unless the user explicitly uses the <code class="docutils literal notranslate"><span class="pre">workflow:update</span></code>
<a class="reference internal" href="guide/magic-arguments.html#magic-arguments"><span class="std std-ref">“magic” argument</span></a>, but you can check the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">Workflow.update_available</span></code>
attribute and inform the user of the availability of an update if it’s
<code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
<p>See <a class="reference internal" href="guide/update.html#guide-updates"><span class="std std-ref">Self-updating</span></a> in the <a class="reference internal" href="guide/index.html#user-manual"><span class="std std-ref">User Guide</span></a> for information on how to
enable your workflow to update itself from GitHub.</p>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="https://docs.python.org/2.7/library/argparse.html#module-argparse" title="(in Python v2.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a> isn’t available in Python 2.6, so this workflow won’t
run on Snow Leopard (10.6).</td></tr>
</tbody>
</table>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/icon_256.png" alt="Logo"/>
    
    <h1 class="logo logo-name">Alfred-Workflow</h1>
    
  </a>
</p>



<p class="blurb">A helper library for creating workflows for Alfred 2+.</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=deanishe&repo=alfred-workflow&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p class="shield">
<a href="https://travis-ci.org/deanishe/alfred-workflow">
    <img
        alt="https://secure.travis-ci.org/deanishe/alfred-workflow.svg?branch=master"
        src="https://secure.travis-ci.org/deanishe/alfred-workflow.svg?branch=master"
    />
</a>
</p>




    

<p class="shield">
<a href="https://coveralls.io/github/deanishe/alfred-workflow">
    <img
    alt="coverage icon"
    src="https://coveralls.io/repos/github/deanishe/alfred-workflow/badge.svg?branch=master"
    />
</a>








    

<p class="shield">
<a href="https://pypi.python.org/pypi/Alfred-Workflow">
    <img
    alt="https://img.shields.io/pypi/v/Alfred-Workflow.svg?style=flat"
    src="https://img.shields.io/pypi/v/Alfred-Workflow.svg?style=flat"
    />
</a>
<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="supported-versions.html">Supported versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorial.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial.html#part-1-a-basic-pinboard-workflow">Part 1: A Basic Pinboard Workflow</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="tutorial.html#part-2-a-distribution-ready-pinboard-workflow">Part 2: A Distribution-Ready Pinboard Workflow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">API documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="dash.html">Dash docset</a></li>
<li class="toctree-l1"><a class="reference internal" href="licence.html">Licence</a></li>
<li class="toctree-l1"><a class="reference internal" href="aw-workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="indices.html">Indices</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="tutorial.html">Tutorial</a><ul>
      <li>Previous: <a href="tutorial_1.html" title="previous chapter">Tutorial Part 1: Creating a Basic Pinboard Workflow</a></li>
      <li>Next: <a href="guide/index.html" title="next chapter">User Guide</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<h3>Donate</h3>
<p>Consider supporting the authors</p>
<ul class="donations">
	
	<li class="donate"><a href="https://paypal.me/deanishe"><img src="https://www.paypalobjects.com/webstatic/en_US/i/buttons/PP_logo_h_100x26.png" alt="PayPal" title="PayPal"></a></li>
	
	
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>


    <div class="footer">
      &copy; 2013–2020 Dean Jackson.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    

<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//deanishe.net/piwik/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 3]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//deanishe.net/piwik/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->


  </body>
</html>